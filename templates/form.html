{% extends "base.html" %}
{% block content %}

<h2>Créer une ressource : {{ resource_name }}</h2>

<form action="/generate" method="POST">

    <label>Provider :</label>
    <select name="provider_name">
        {% for p in providers %}
            <option value="{{ p }}">{{ p }}</option>
        {% endfor %}
    </select>

    <label style="margin-top:15px;">
        <input type="checkbox" id="advancedToggle" onchange="toggleAdvanced()"> 
        Afficher les options avancées
    </label>

    <input type="hidden" name="resource_name" value="{{ resource_name }}">

    {% for field in schema %}
    <div class="field {% if field.level == 'advanced' %}advanced-field{% endif %}">
        <label>{{ field.label }}</label>

        {% if field.ui_control == "text" %}
            <input type="text" name="{{ field.name }}" placeholder="{{ field.placeholder }}" value="{{ field.default }}">
        {% elif field.ui_control == "number" %}
            <input type="number" name="{{ field.name }}" value="{{ field.default }}">
        {% elif field.ui_control == "select" %}
            <select name="{{ field.name }}">
                {% for opt in field.options %}
                <option value="{{ opt }}" {% if field.default == opt %}selected{% endif %}>{{ opt }}</option>
                {% endfor %}
            </select>
        {% elif field.ui_control == "textarea" %}
            <textarea name="{{ field.name }}" placeholder="{{ field.placeholder }}"></textarea>
        {% endif %}

        <small>{{ field.comment }}</small>
    </div>
    {% endfor %}

    <button type="submit">Générer le YAML</button>
    <a href="javascript:history.back()" class="btn">Retour</a>
</form>

<script>
function toggleAdvanced() {
    const checked = document.getElementById('advancedToggle').checked;
    const advancedFields = document.querySelectorAll('.advanced-field');

    advancedFields.forEach(f => {
        f.style.display = checked ? 'block' : 'none';
    });
}
window.onload = toggleAdvanced;
</script>

{% endblock %}
