{% extends "base.html" %}
{% block content %}
<h2>Créer une ressource : {{ resource_name }}</h2>

<form action="/generate" method="POST">

    <label>Provider:</label>
    <select name="provider_name">
        {% for p in providers %}
        <option value="{{ p }}">{{ p }}</option>
        {% endfor %}
    </select>
    <br><br>

    <label>
        <input type="checkbox" id="advancedToggle" onchange="toggleAdvanced()"> 
        Afficher les options avancées
    </label>
    <br><br>

    <input type="hidden" name="resource_name" value="{{ resource_name }}">

    {% for field in schema %}
    <div class="field {% if field.level == 'advanced' %}advanced-field{% endif %}">
        <label>{{ field.label }}</label>

        {% if field.ui_control == "text" %}
            <input 
                type="text" 
                name="{{ field.name }}" 
                placeholder="{{ field.placeholder }}" 
                value="{% if field.default is not none %}{{ field.default }}{% endif %}">
        
        {% elif field.ui_control == "number" %}
            <input 
                type="number" 
                name="{{ field.name }}" 
                placeholder="{{ field.placeholder }}" 
                value="{% if field.default is not none %}{{ field.default }}{% endif %}">
        
        {% elif field.ui_control == "select" and field.options %}
            <select name="{{ field.name }}">
                {% for opt in field.options %}
                <option value="{{ opt }}"
                    {% if field.default == opt %}selected{% endif %}>
                    {{ opt }}
                </option>
                {% endfor %}
            </select>

        {% elif field.ui_control == "textarea" %}
            <textarea name="{{ field.name }}" placeholder="{{ field.placeholder }}"></textarea>

        {% endif %}

        <small>{{ field.comment }}</small>
    </div>
    <br>
    {% endfor %}

    <button type="submit">Générer YAML</button>
</form>

<script>
function toggleAdvanced() {
    const checked = document.getElementById('advancedToggle').checked;
    const advancedFields = document.querySelectorAll('.advanced-field');

    advancedFields.forEach(f => {
        f.style.display = checked ? 'block' : 'none';
    });
}

// Masquer les champs avancés par défaut au chargement
window.addEventListener('load', () => {
    document.getElementById('advancedToggle').checked = false;
    toggleAdvanced();
});
</script>

{% endblock %}
