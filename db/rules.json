{
  "providers": ["aws", "azure", "gcp"],

  "resources": {

    "deployment": {
      "label": "Deployment",
      "description": "Déploie automatiquement plusieurs instances (réplicas) d'une application pour assurer sa disponibilité.",

      "fields": {
        "name": {
          "type": "string",
          "label": "Nom de l'application",
          "comment": "Nom unique de votre application. Sert pour les pods, labels et services.",
          "ui_control": "text",
          "placeholder": "ex: mon-api",
          "default": "",
          "level": "basic",
          "required": true
        },

        "namespace": {
          "type": "string",
          "label": "Namespace",
          "comment": "Espace logique de Kubernetes. Laissez 'default' si vous ne savez pas.",
          "ui_control": "text",
          "default": "default",
          "placeholder": "default",
          "level": "basic"
        },

        "replicas": {
          "type": "integer",
          "label": "Nombre d'instances",
          "comment": "Nombre de copies identiques de votre application.",
          "ui_control": "number",
          "default": 1,
          "level": "basic"
        },

        "image": {
          "type": "string",
          "label": "Image Docker",
          "comment": "L'image Docker contenant votre application (ex: nginx:latest).",
          "ui_control": "text",
          "placeholder": "ex: monrepo/app:latest",
          "default": "",
          "required": true,
          "level": "basic"
        },

        "container_port": {
          "type": "integer",
          "label": "Port de l'application",
          "comment": "Port interne d'écoute du container.",
          "ui_control": "number",
          "default": 80,
          "level": "basic"
        },

        "env": {
          "type": "map",
          "label": "Variables d'environnement",
          "comment": "Pour configurer l'application sans modifier l'image Docker.",
          "ui_control": "textarea",
          "placeholder": "KEY=VALUE",
          "level": "advanced"
        }
      },

      "provider_overrides": {},

      "template": {
        "apiVersion": "apps/v1",
        "kind": "Deployment",
        "metadata": {
          "name": "$name",
          "namespace": "$namespace"
        },
        "spec": {
          "replicas": "$replicas",
          "selector": {
            "matchLabels": { "app": "$name" }
          },
          "template": {
            "metadata": {
              "labels": { "app": "$name" }
            },
            "spec": {
              "containers": [
                {
                  "name": "$name",
                  "image": "$image",
                  "ports": [
                    { "containerPort": "$container_port" }
                  ]
                }
              ]
            }
          }
        }
      }
    },





    "service": {
      "label": "Service",
      "description": "Expose votre application pour permettre aux autres services ou utilisateurs d'y accéder.",

      "fields": {
        "name": {
          "type": "string",
          "label": "Nom du service",
          "comment": "Nom réseau d'accès à votre application.",
          "ui_control": "text",
          "placeholder": "ex: mon-api-svc",
          "default": "",
          "required": true,
          "level": "basic"
        },

        "namespace": {
          "type": "string",
          "label": "Namespace",
          "ui_control": "text",
          "default": "default",
          "level": "basic"
        },

        "type": {
          "type": "string",
          "label": "Mode d'exposition",
          "comment": "ClusterIP = interne, NodePort = accès machine, LoadBalancer = accès internet.",
          "ui_control": "select",
          "options": ["ClusterIP", "NodePort", "LoadBalancer"],
          "default": "ClusterIP",
          "level": "basic"
        },

        "port": {
          "type": "integer",
          "label": "Port externe",
          "ui_control": "number",
          "default": 80,
          "level": "basic"
        },

        "target_port": {
          "type": "integer",
          "label": "Port interne du container",
          "ui_control": "number",
          "default": 80,
          "level": "basic"
        },

        "annotations": {
          "type": "map",
          "label": "Annotations supplémentaires",
          "comment": "Utiles pour configurer les load balancers cloud.",
          "ui_control": "textarea",
          "placeholder": "clé: valeur",
          "level": "advanced"
        }
      },

      "provider_overrides": {
        "aws": {
          "annotations": {
            "service.beta.kubernetes.io/aws-load-balancer-type": "nlb",
            "service.beta.kubernetes.io/aws-load-balancer-internal": "false"
          }
        },
        "gcp": {
          "annotations": {
            "cloud.google.com/load-balancer-type": "External"
          }
        },
        "azure": {
          "annotations": {
            "service.beta.kubernetes.io/azure-load-balancer-internal": "false"
          }
        }
      },

      "template": {
        "apiVersion": "v1",
        "kind": "Service",
        "metadata": {
          "name": "$name",
          "namespace": "$namespace",
          "annotations": "$annotations"
        },
        "spec": {
          "type": "$type",
          "selector": { "app": "$name" },
          "ports": [
            {
              "port": "$port",
              "targetPort": "$target_port"
            }
          ]
        }
      }
    },




    "ingress": {
      "label": "Ingress",
      "description": "Expose votre application via un nom de domaine (HTTP/HTTPS).",

      "fields": {
        "name": {
          "type": "string",
          "label": "Nom de l'Ingress",
          "ui_control": "text",
          "placeholder": "ex: mon-api-ingress",
          "default": "",
          "level": "basic"
        },

        "namespace": {
          "type": "string",
          "label": "Namespace",
          "ui_control": "text",
          "default": "default",
          "level": "basic"
        },

        "host": {
          "type": "string",
          "label": "Nom de domaine",
          "ui_control": "text",
          "placeholder": "ex: api.monsite.com",
          "default": "",
          "level": "basic"
        },

        "path": {
          "type": "string",
          "label": "Chemin HTTP",
          "ui_control": "text",
          "default": "/",
          "level": "basic"
        },

        "service_name": {
          "type": "string",
          "label": "Service associé",
          "ui_control": "text",
          "default": "",
          "level": "basic"
        },

        "service_port": {
          "type": "integer",
          "label": "Port du service",
          "ui_control": "number",
          "default": 80,
          "level": "basic"
        },

        "annotations": {
          "type": "map",
          "label": "Annotations avancées",
          "ui_control": "textarea",
          "placeholder": "clé: valeur",
          "level": "advanced"
        }
      },

      "provider_overrides": {
        "aws": {
          "annotations": {
            "kubernetes.io/ingress.class": "alb",
            "alb.ingress.kubernetes.io/scheme": "internet-facing"
          }
        },
        "gcp": {
          "annotations": {
            "kubernetes.io/ingress.class": "gce"
          }
        },
        "azure": {
          "annotations": {
            "kubernetes.io/ingress.class": "azure/application-gateway"
          }
        }
      },

      "template": {
        "apiVersion": "networking.k8s.io/v1",
        "kind": "Ingress",
        "metadata": {
          "name": "$name",
          "namespace": "$namespace",
          "annotations": "$annotations"
        },
        "spec": {
          "rules": [
            {
              "host": "$host",
              "http": {
                "paths": [
                  {
                    "path": "$path",
                    "pathType": "Prefix",
                    "backend": {
                      "service": {
                        "name": "$service_name",
                        "port": { "number": "$service_port" }
                      }
                    }
                  }
                ]
              }
            }
          ]
        }
      }
    },





    "pvc": {
      "label": "PersistentVolumeClaim",
      "description": "Réserve du stockage persistant dans le cluster ou le cloud.",

      "fields": {
        "name": {
          "type": "string",
          "label": "Nom du PVC",
          "ui_control": "text",
          "default": "",
          "placeholder": "ex: data-volume",
          "level": "basic"
        },

        "namespace": {
          "type": "string",
          "label": "Namespace",
          "ui_control": "text",
          "default": "default",
          "level": "basic"
        },

        "storage": {
          "type": "string",
          "label": "Taille du stockage",
          "comment": "Ex: 1Gi, 5Gi, 20Gi",
          "ui_control": "text",
          "default": "1Gi",
          "level": "basic"
        }
      },

      "provider_overrides": {
        "aws": {
          "storageClassName": "gp2"
        },
        "gcp": {
          "storageClassName": "standard-rwo"
        },
        "azure": {
          "storageClassName": "managed-premium"
        }
      },

      "template": {
        "apiVersion": "v1",
        "kind": "PersistentVolumeClaim",
        "metadata": {
          "name": "$name",
          "namespace": "$namespace"
        },
        "spec": {
          "accessModes": ["ReadWriteOnce"],
          "resources": {
            "requests": {
              "storage": "$storage"
            }
          },
          "storageClassName": null
        }
      }
    },





    "configmap": {
      "label": "ConfigMap",
      "description": "Stocke des paramètres non sensibles sous forme clé/valeur.",

      "fields": {
        "name": {
          "type": "string",
          "label": "Nom du ConfigMap",
          "ui_control": "text",
          "placeholder": "ex: app-config",
          "default": "",
          "level": "basic"
        },

        "namespace": {
          "type": "string",
          "label": "Namespace",
          "ui_control": "text",
          "default": "default",
          "level": "basic"
        },

        "data": {
          "type": "map",
          "label": "Clés / valeurs",
          "ui_control": "textarea",
          "placeholder": "clé: valeur",
          "level": "basic"
        }
      },

      "provider_overrides": {},

      "template": {
        "apiVersion": "v1",
        "kind": "ConfigMap",
        "metadata": {
          "name": "$name",
          "namespace": "$namespace"
        },
        "data": "$data"
      }
    },




    "secret": {
      "label": "Secret",
      "description": "Stocke les données sensibles (mots de passe, clés API...).",

      "fields": {
        "name": {
          "type": "string",
          "label": "Nom du secret",
          "ui_control": "text",
          "placeholder": "ex: db-secret",
          "default": "",
          "level": "basic"
        },

        "namespace": {
          "type": "string",
          "label": "Namespace",
          "ui_control": "text",
          "default": "default",
          "level": "basic"
        },

        "data": {
          "type": "map",
          "label": "Clés / valeurs (base64)",
          "comment": "Encodez les valeurs en base64.",
          "ui_control": "textarea",
          "placeholder": "clé: valeur_base64",
          "level": "basic"
        }
      },

      "provider_overrides": {},

      "template": {
        "apiVersion": "v1",
        "kind": "Secret",
        "metadata": {
          "name": "$name",
          "namespace": "$namespace"
        },
        "data": "$data",
        "type": "Opaque"
      }
    }
  }
}
